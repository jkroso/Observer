/*! Observer - v0.1.0 - 2012-07-04
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(b){typeof b=="object"&&(b.publish=a.prototype.publish,b.run=a.prototype.run,b.on=a.prototype.on,b.off=a.prototype.off),(b||this).__base__=new c}function b(a,b,c){this.context=a,this.callback=b,this.priority=c}function c(a){this._listeners=[],this._parent=a}return"use strict",a.prototype={publish:function(a,b){var c=this.__base__[a],d,e;if(!c){c=this.__base__,a=a.split("."),e=0;while(e<a.length)if(c.hasOwnProperty(a[e]))c=c[a[e++]];else break}do{d=c._listeners,e=d.length-1;if(e>=0)do if((a=d[e]).callback.call(a.context,b)===!1)return!1;while(e--)}while((c=c._parent)!==undefined);return!0},run:function(a,b){var c;if(a=this.__base__[a]){a=a._listeners,c=a.length-1;if(c!==-1)do if(a[c].trigger(b)===!1)return!1;while(c--);return!0}},on:function(a,c,d,e){switch(arguments.length){case 3:typeof d=="number"?(e=d,d=c,c=window):e=0;break;case 2:d=c,c=window,e=0;break;case 1:d=a,a="",c=window,e=0;break;case 0:throw"Insufficient arguments"}if(typeof d!="function")throw"Incorrect argument format";if(typeof e!="number")throw"Incorrect argument format";var f=new b(c,d,e);return a.split(" ").forEach(function(a){var b=this.__base__,c=a.split(".");for(var d=0,e=c.length;d<e;d++){if(c[d]==="")break;b.hasOwnProperty([c[d]])?b=b[c[d]]:b=b.createSubTopic(c[d],c.slice(0,d+1).join("."))}b.insertListener(f)},this),f},off:function(a,b){if(typeof a!="string")throw"Need to provide a topic";a.split(" ").forEach(function(a){var c=this.__base__,d=a.split(".");for(var e=0,f=d.length;e<f;e++)c.hasOwnProperty([d[e]])&&(c=c[d[e]]);c.removeListener(b)},this)},constructor:a},b.prototype={trigger:function(a){return this.callback.call(this.context,a)}},c.prototype={createSubTopic:function(a,b){this[a]=new c(this);var d=this;while(d._parent)d=d._parent;return d[b]=this[a]},insertListener:function(a){var b=this._listeners.slice(),c=b.length,d=a.priority,e=0,f=!1;for(;e<c;e++)if(b[e].priority>=d){b.splice(e,0,a),f=!0;break}f||b.push(a),this._listeners=b},removeListener:function(a){var b;switch(typeof a){case"function":b=function(b){return b.callback!==a};break;case"string":b=function(b){return b.callback.name!==a};break;case"object":b=function(b){return b!==a};break;default:b=function(){return!1}}this._listeners=this._listeners.filter(b)},invokeListeners:function(a){var b=this._listeners,c=b.length-1;if(c!==-1)do if(b[c].trigger(a)===!1)return!1;while(c--);return!0}},a.prototype.unsubscribe=a.prototype.off,a.prototype.subscribe=a.prototype.on,a.Subscription=b,a})