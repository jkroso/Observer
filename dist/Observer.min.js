/*! Observer - v0.1.0 - 2012-06-27
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(a,b){var c=a._listeners.slice(),d=c.length,e=b.priority,f=0,g=!1;for(;f<d;f++)if(c[f].priority>=e){c.splice(f,0,b),g=!0;break}g||c.push(b),a._listeners=c}function b(a,b){var c;switch(typeof b){case"function":c=function(a){return a.callback!==b};break;case"string":c=function(a){return a.callback.name!==b};break;case"object":c=function(a){return a!==b};break;default:c=function(){return!1}}a._listeners=a._listeners.filter(c)}function c(a,b,c){this.context=a,this.callback=b,this.priority=c}function d(a){var b=a.indexOf(".");return b===-1?a:a.substr(0,b)}function e(a){var b=a.indexOf(".");return b===-1?"":a.substr(b+1)}function f(){this._listeners=[]}function g(a,b,c){var f=a._listeners,h=f.length-1;if(b&&(a=a[d(b)])&&g(a,e(b),c)===!1)return!1;if(h!==-1)do if(f[h].trigger(c)===!1)return!1;while(h--);return!0}function h(a){typeof a=="object"&&(a.publish=h.prototype.publish,a.run=h.prototype.run,a.on=h.prototype.on,a.off=h.prototype.off),(a||this).__base__=new f}return"use strict",c.prototype={trigger:function(a){return this.callback.call(this.context,a)}},h.prototype={publish:function(a,b){return g(this.__base__,a,b)},run:function(a,b){if(a=this.__base__[a]){var c=a._listeners,d=c.length-1;if(d!==-1)do if(c[d].trigger(b)===!1)return!1;while(d--);return!0}},on:function(b,g,h,i){switch(arguments.length){case 3:typeof h=="number"?(i=h,h=g,g=window):i=0;break;case 2:h=g,g=window,i=0;break;case 1:h=b,b="",g=window,i=0;break;case 0:throw"Insufficient arguments"}if(typeof h!="function")throw"Incorrect argument format";if(typeof i!="number")throw"Incorrect argument format";var j=new c(g,h,i);return b.split(" ").forEach(function k(b){var c=d(b);c?(this.hasOwnProperty(c)||(this[c]=new f),k.call(this[c],e(b))):a(this,j)},this.__base__),j},off:function(a,c){if(typeof a!="string")throw"Need tp provide a topic";a.split(" ").forEach(function f(a){var g=d(a);if(!g)b(this,c);else{if(!this.hasOwnProperty(g))return;f.call(this[g],e(a))}},this.__base__)},constructor:h},h.prototype.unsubscribe=h.prototype.off,h.prototype.subscribe=h.prototype.on,h.Subscription=c,h})