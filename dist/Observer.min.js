/*! Observer - v0.1.0 - 2012-06-16
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(){this._listeners=[]}function b(a,b,c){this.context=a,this.callback=b,this.priority=c}function c(b){typeof b=="object"&&(b.publish=c.prototype.publish,b.run=c.prototype.run,b.on=c.prototype.on,b.off=c.prototype.off),(b||this).subscriptions=new a}return"use strict",a.prototype={createSubTopic:function(b){this[b]=new a},insertListener:function(a){var b=this._listeners.slice(),c=b.length,d=a.priority,e=0,f=!1;for(;e<c;e++)if(b[e].priority>=d){b.splice(e,0,a),f=!0;break}f||b.push(a),this._listeners=b},removeListener:function(a){var b=this._listeners,c=b.length,d;switch(typeof a){case"function":d=function(b){return b.callback!==a};break;case"string":d=function(b){return b.callback.name!==a};break;case"object":d=function(b){return b!==a};break;default:d=function(){return!1}}this._listeners=b.filter(d)}},b.prototype={trigger:function(a){return this.callback.call(this.context,a)}},c.prototype={publish:function(a,b){var c=this.subscriptions,d=a.split("."),e=[c],f=0,g,h,i;if(c=c[d[f]])do e[++f]=c;while(c=c[d[f]]);f<d.length&&console.info(a+" was only subscribed as far as: "+d.slice(0,f).join("."));do{g=e[f]._listeners,i=g.length-1;if(i!==-1)do if(g[i].trigger(b)===!1)return!1;while(i--)}while(f--);return!0},run:function(a,b){if(a=this.subscriptions[a]){var c=a._listeners,d=c.length-1;if(d!==-1)do if(c[d].trigger(b)===!1)return!1;while(d--);return!0}},on:function(a,c,d,e){switch(arguments.length){case 3:typeof d=="number"?(e=d,d=c,c=window):e=0;break;case 2:d=c,c=window,e=0;break;case 1:d=a,a="",c=window,e=0;break;case 0:throw"Insufficient arguments"}if(typeof d!="function")throw"Incorrect argument format";if(typeof e!="number")throw"Incorrect argument format";a=a.split(" ");var f=new b(c,d,e),g=this.subscriptions,h=a.length;return a[0]===""?g.insertListener(f):a.forEach(function(a){var b=this.subscriptions,c=a.split(".");for(var d=0,e=c.length;d<e;d++)b[c[d]]||b.createSubTopic(c[d]),b=b[c[d]];b.insertListener(f)},this),f},off:function(a,b){if(typeof a!="string")throw"Need tp provide a topic";a=a.split(" "),a.forEach(function(a){var c=a.split("."),d=this.subscriptions;for(var e=0,f=c.length;e<f;e++){if(!d[c[e]]){d=!1;break}d=d[c[e]]}d&&d.removeListener(b)},this)},constructor:c},c.prototype.unsubscribe=c.prototype.off,c.prototype.subscribe=c.prototype.on,c.Subscription=b,c.Topic=a,c})