/*! Observer - v0.1.0 - 2012-07-20
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(b){return b&&a.methods(typeof b=="object"?b:this),Object.defineProperties(this,{_base:{value:new d,writable:!0}})}function b(a,b,c){a=a.split(".");if(a[0]){var e,f=a.length,g=0;while(g<f){e=a[g++];if(b[e]instanceof d)b=b[e];else if(c)b=b.createSubTopic(e);else break}}return b}function c(a,b,c){if(typeof b!="function"||typeof c!="number")throw"Incorrect argument format";this.context=a,this.callback=b,this.priority=c}function d(a){Object.defineProperties(this,{_listeners:{value:Object.prototype.toString.call(a)==="[object Array]"?a:[],writable:!0}})}return"use strict",a.methods=function(b){return Object.keys(a.prototype).forEach(function(c){b.hasOwnProperty(c)||Object.defineProperty(b,c,{value:a.prototype[c],writable:!0,configurable:!0})}),b},a.prototype={publish:function(b,c){typeof b=="string"?b=a.prototype.collect.call(this,b.split(".")):(c=b,b=this._base._listeners);var d=b.length,e,f;while(d--){e=b[d],f=e.length;if(f>0)do if(e[--f].trigger(c)===!1)return!1;while(f)}return!0},run:function(a,b){var c=this._base,d,e,f;if(typeof a=="string"){a=a.split("."),e=0,d=a.length;while(e<d){f=a[e++];if(typeof c[f]=="object")c=c[f];else return!1}}else b=a;c=c._listeners,e=c.length;if(e>0)do if(c[--e].trigger(b)===!1)return!1;while(e>0);return!0},on:function(a,d,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=d,d=window):f=0;break;case 2:e=d,d=window,f=0;break;case 1:e=a,a="",d=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new c(d,e,f);return a.split(" ").forEach(function(a){b(a,this,!0).insertListener(g)},this._base),g},once:function(a,d,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=d,d=window):f=0;break;case 2:e=d,d=window,f=0;break;case 1:e=a,a="",d=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new c(d,e,f);return g._topics=[],g.trigger=function(a){return this._topics.forEach(function(a){a.removeListener(this)}),this.callback.call(this.context,a)},a.split(" ").forEach(function(a){var c=b(a,this,!0);g._topics.push(c),c.insertListener(g)},this._base),g},off:function(a,c){if(typeof a!="string")if(!c)this._base.removeListener(a);else throw"no topic specified";a.split(" ").forEach(function(a){a=b(a,this,!1),a&&a.removeListener(c)},this._base)},branchingCollect:function e(a,b){var c=0,d=a.length,f,g,h=[b._listeners];while(c<d)f=a[c++],g=f[0],g in b&&(h=h.concat(e(f.slice(1),b[g])));return h},collect:function(a){var b=this._base,c=[b._listeners],d=a.length,e=0;while(e<d){b=b[a[e++]];if(b)c.push(b._listeners);else break}return c}},Object.defineProperty(a.prototype,"constructor",{value:a}),c.prototype={trigger:function(a){return this.callback.call(this.context,a)}},d.prototype={createSubTopic:function(a,b){return this[a]=new d(b)},insertListener:function(a){var b=this._listeners.slice(),c=a.priority,d=!1;for(var e=0,f=b.length;e<f;e++)if(b[e].priority>=c){b.splice(e,0,a),d=!0;break}return d||b.push(a),this._listeners=b,this},removeListener:function(a){var b;switch(typeof a){case"function":b=function(b){return b.callback!==a};break;case"string":b=function(b){return b.callback.name!==a};break;case"object":b=function(b){return b!==a};break;default:b=function(){return!1}}return this._listeners=this._listeners.filter(b),this},invoke:function(a){var b=this._listeners,c=b.length;if(c>0)do if(b[--c].trigger(a)===!1)return!1;while(c);return!0}},a});