/*! Observer - v0.1.0 - 2012-06-13
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(){this._listeners=[]}function b(a,b){return a.callback===b}function c(a,b){return a.callback.name===b}function d(a,b){return a===b}function e(){return!0}function f(a,b,c){this.context=a,this.callback=b,this.priority=c}function g(){this.subscriptions=new a}return"use strict",a.prototype={createSubTopic:function(b){this[b]=new a},insertListener:function(a){var b=this._listeners.slice(),c=b.length,d=a.priority,e=0,f=!1;for(;e<c;e++)if(b[e].priority>=d){b.splice(e,0,a),f=!0;break}f||b.push(a),this._listeners=b},removeListener:function(a){var f=this._listeners,g=f.length,h;switch(typeof a){case"function":h=b;break;case"string":h=c;break;case"object":h=d;break;default:h=e}this._listeners=f.filter(function(b){return!h(b,a)})}},f.prototype={trigger:function(a){return this.callback.call(this.context,a)}},g.prototype={publish:function(a,b){var c=this.subscriptions,d=a.split("."),e=[c],f=0,g,h,i;if(c=c[d[f]])do e[++f]=c;while(c=c[d[f]]);f<d.length&&console.info(a+" was only subscribed as far as: "+d.slice(0,f).join("."));do{g=e[f]._listeners,i=g.length-1;if(i!==-1)do if(g[i].trigger(b)===!1)return!1;while(i--)}while(f--);return!0},run:function(a,b){if(a=this.subscriptions[a]){var c=a._listeners,d=c.length-1;if(d!==-1)do c[d].trigger(b);while(d--)}},on:function(a,b,c,d){switch(arguments.length){case 3:typeof c=="number"?(d=c,c=b,b=window):d=5;break;case 2:c=b,b=window,d=5;break;case 1:c=a,a="",b=window,d=5;break;case 0:throw"Insufficient arguments"}if(typeof c!="function")throw"Incorrect argument format";if(typeof d!="number")throw"Incorrect argument format";a=a.split(" ");var e=new f(b,c,d),g=this.subscriptions,h=a.length;return a[0]===""?g.insertListener(e):a.forEach(function(a){var b=this.subscriptions,c=a.split(".");for(var d=0,f=c.length;d<f;d++)b[c[d]]||b.createSubTopic(c[d]),b=b[c[d]];b.insertListener(e)},this),e},off:function(a,b){if(typeof a!="string")throw"Need tp provide a topic";a=a.split(" "),a.forEach(function(a){var c=a.split("."),d=this.subscriptions;for(var e=0,f=c.length;e<f;e++){if(!d[c[e]]){d=!1;break}d=d[c[e]]}d&&d.removeListener(b)},this)},constructor:g},g.prototype.unsubscribe=g.prototype.off,g.prototype.subscribe=g.prototype.on,g.Subscription=f,g.Topic=a,g})