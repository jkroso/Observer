/*! Observer - v0.1.0 - 2012-06-27
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(c){typeof c=="object"&&(c.publish=a.prototype.publish,c.run=a.prototype.run,c.on=a.prototype.on,c.off=a.prototype.off),(c||this).__base__=new b}function b(){this._listeners=[]}function c(a,b,c){this.context=a,this.callback=b,this.priority=c}function d(a,b){var c=a._listeners.slice(),d=c.length,e=b.priority,f=0,g=!1;for(;f<d;f++)if(c[f].priority>=e){c.splice(f,0,b),g=!0;break}g||c.push(b),a._listeners=c}function e(a,b){var c;switch(typeof b){case"function":c=function(a){return a.callback!==b};break;case"string":c=function(a){return a.callback.name!==b};break;case"object":c=function(a){return a!==b};break;default:c=function(){return!1}}a._listeners=a._listeners.filter(c)}function f(a){var b=a.indexOf(".");return b===-1?a:a.substr(0,b)}function g(a){var b=a.indexOf(".");return b===-1?"":a.substr(b+1)}function h(a,b,c,d){var e=a._listeners,f=e.length-1;if(a=a[b[c]])if(h(a,b,c+1,d)===!1)return!1;if(f!==-1)do if(e[f].trigger(d)===!1)return!1;while(f--);return!0}return"use strict",a.prototype={publish:function(a,b){return h(this.__base__,a.split("."),0,b)},run:function(a,b){var c;if(a=this.__base__[a]){a=a._listeners,c=a.length-1;if(c!==-1)do if(a[c].trigger(b)===!1)return!1;while(c--);return!0}},on:function(a,e,h,i){switch(arguments.length){case 3:typeof h=="number"?(i=h,h=e,e=window):i=0;break;case 2:h=e,e=window,i=0;break;case 1:h=a,a="",e=window,i=0;break;case 0:throw"Insufficient arguments"}if(typeof h!="function")throw"Incorrect argument format";if(typeof i!="number")throw"Incorrect argument format";var j=new c(e,h,i);return a.split(" ").forEach(function k(a){var c=f(a);c?(this.hasOwnProperty(c)||(this[c]=new b),k.call(this[c],g(a))):d(this,j)},this.__base__),j},off:function(a,b){if(typeof a!="string")throw"Need tp provide a topic";a.split(" ").forEach(function c(a){var d=f(a);if(!d)e(this,b);else{if(!this.hasOwnProperty(d))return;c.call(this[d],g(a))}},this.__base__)},constructor:a},c.prototype={trigger:function(a){return this.callback.call(this.context,a)}},a.prototype.unsubscribe=a.prototype.off,a.prototype.subscribe=a.prototype.on,a.Subscription=c,a})