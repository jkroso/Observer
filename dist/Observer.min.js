/*! Observer - v0.1.0 - 2012-08-12
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define("Subscription",[],function(){function a(a,b,c){if(typeof b!="function"||typeof c!="number")throw"Incorrect argument format";this.context=a,this.callback=b,this.priority=c}return a.prototype={trigger:function(a){return this.callback.call(this.context,a)}},a}),define("Observer",["Subscription"],function(a){function b(a){Object.defineProperties(this,{_listeners:{value:a&&Object.prototype.toString.call(a)==="[object Array]"?a:[],writable:!0}})}function c(a,b){var c=a.length,d,e;while(c--){e=a[c],d=e.length;if(d>0)do if(e[--d].trigger(b)===!1)return!1;while(d)}return!0}function d(a,b){var c=a._listeners.slice(),d=b.priority,e=!1;for(var f=0,g=c.length;f<g;f++)if(c[f].priority>=d){c.splice(f,0,b),e=!0;break}e||c.push(b),a._listeners=c}function e(a,b){var c;switch(typeof b){case"function":c=function(a){return a.callback!==b};break;case"string":c=function(a){return a.callback.name!==b};break;case"object":c=function(a){return a!==b};break;default:c=function(){return!1}}a._listeners=a._listeners.filter(c)}function f(a,b){var c=0,d=b.length,e,g,h=[a._listeners];while(c<d)e=b[c++],g=e[0],g in a&&(h=h.concat(f(a[g],e.slice(1))));return h}function g(a,b){var c=[a._listeners],d=b.length,e=0;while(e<d){a=a[b[e++]];if(a)c.push(a._listeners);else break}return c}return b.prototype={get:function(a,c){if(!a)return this;a=a.split(".");var d=this,e,f=a.length,g=0;if(f)do{e=a[g++];if(d[e]instanceof b)d=d[e];else{if(d[e])throw"namespace clash: "+e;if(c)d=d[e]=new b;else break}}while(g<f);return d},invoke:function(a){var b=this._listeners,c=b.length;if(c>0)do if(b[--c].trigger(a)===!1)return!1;while(c);return!0},publish:function(a,b){return typeof a=="string"?a=g(this,a.split(".")):(b=a,a=this._listeners),c(a,b)},on:function(b,c,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=c,c=window):f=0;break;case 2:e=c,c=window,f=0;break;case 1:e=b,b="",c=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new a(c,e,f);return b.split(" ").forEach(function(a){d(this.get(a,!0),g)},this),g},once:function(b,c,f,g){switch(arguments.length){case 3:typeof f=="number"?(g=f,f=c,c=window):g=0;break;case 2:f=c,c=window,g=0;break;case 1:f=b,b="",c=window,g=0;break;case 0:throw"Insufficient arguments"}var h=new a(c,f,g);return h._topics=[],h.trigger=function(a){return this._topics.forEach(function(a){e(a,this)},this),this.callback.call(this.context,a)},b.split(" ").forEach(function(a){var b=this.get(a,!0);h._topics.push(b),d(b,h)},this),h},off:function(a,b){if(typeof a!="string")if(!b)e(this,a);else throw"no topic specified";a.split(" ").forEach(function(a){a=this.get(a,!1),a&&e(a,b)},this)}},b.methods=function(a){return Object.keys(b.prototype).forEach(function(c){a.hasOwnProperty(c)||Object.defineProperty(a,c,{value:b.prototype[c],writable:!0,configurable:!0})}),a},b.mixin=function(a){return b.call(a),b.methods(a),a},b.invokeList=c,b.insertListener=d,b.removeListener=e,b.collect=g,b.branchingCollect=f,Object.defineProperty(b.prototype,"constructor",{value:b}),new b});