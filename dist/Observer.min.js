/*! Observer - v0.1.0 - 2012-07-17
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(b){return b&&a.methods(typeof b=="object"?b:this),Object.defineProperties(this,{_base:{value:new e(null,this),writable:!0}})}function b(a,b,d){var e;a=new c(a);while(e=a.next())if(b.hasOwnProperty(e))b=b[e];else if(d)b=b.createSubTopic(e);else break;return b}function c(a){this.data=a,this._last=0}function d(a,b,c){if(typeof b!="function"||typeof c!="number")throw"Incorrect argument format";this.context=a,this.callback=b,this.priority=c}function e(a,b){Object.defineProperties(this,{_parent:{value:b,writable:!0},_name:{value:a},_length:{value:0,writable:!0}})}function f(a){var b=new e(a._name,a._parent),c=a._length;while(c--)Object.defineProperty(b,c,{value:a[c],writable:!0,configurable:!0});return b._length=a._length,Object.keys(a).forEach(function(c){b[c]=a[c]}),b}return"use strict",a.methods=function(b){return Object.keys(a.prototype).forEach(function(c){Object.defineProperty(b,c,{value:a.prototype[c],writable:!0,configurable:!0})}),b},c.prototype={next:function(){var a=this.data.indexOf(".",this._last),b;return a===-1?(b=this.data.slice(this._last),this._last=this.data.length):(b=this.data.slice(this._last,a),this._last=a+1),b}},a.prototype={publish:function(a,b){var c=this._base,d,e,f;if(typeof a=="string"){a=a.split("."),e=0,d=a.length;while(e<d){f=a[e++];if(typeof c[f]=="object")c=c[f];else break}}do{e=c._length-1;if(e>=0)do if((a=c[e]).callback.call(a.context,b)===!1)return!1;while(e--)}while((c=c._parent)!==this);return!0},run:function(a,b){var d=this._base,e;if(typeof a=="string"){a=new c(a);while(e=a.next())if(d.hasOwnProperty(e))d=d[e];else return!1}e=d._length-1;if(e>=0)do if((a=d[e]).callback.call(a.context,b)===!1)return!1;while(e--);return!0},on:function(a,c,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=c,c=window):f=0;break;case 2:e=c,c=window,f=0;break;case 1:e=a,a="",c=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new d(c,e,f);return a.split(" ").forEach(function(a){b(a,this,!0).insertListener(g)},this._base),g},once:function(a,c,e,g){switch(arguments.length){case 3:typeof e=="number"?(g=e,e=c,c=window):g=0;break;case 2:e=c,c=window,g=0;break;case 1:e=a,a="",c=window,g=0;break;case 0:throw"Insufficient arguments"}var h=new d(c,e,g);return a.split(" ").forEach(function(a){var c=b(a,this,!0),e=new d(window,function(){var a=f(c);a.filter(function(a){return a!==e&&a!==h}),c.replace(a)},h.priority);c=c.insertListener(h),c=c.insertListener(e)},this._base),h},off:function(a,c){if(typeof a!="string")if(!c)this._base.removeListener(a);else throw"no topic specified";a.split(" ").forEach(function(a){a=b(a,this,!1),a&&a.removeListener(c)},this._base)}},Object.defineProperty(a.prototype,"constructor",{value:a}),d.prototype={trigger:function(a){return this.callback.call(this.context,a)}},e.prototype={createSubTopic:function(a){return this[a]=new e(a,this)},splice:function(a,b,c){return this.shift(1-b,a,this._length-1),Object.defineProperty(this,a,{value:c,writable:!0,configurable:!0}),this},push:function(a){return Object.defineProperty(this,this._length++,{value:a,writable:!0,configurable:!0}),this},replace:function(a){return this._parent[a._name]=a,Object.keys(a).forEach(function(b){a[b]._parent=a}),this},shift:function(a,b,c){if(a>0)while(c>=b)Object.defineProperty(this,c+a,{value:this[c],writable:!0,configurable:!0}),delete this[c--];else while(b<=c)b+a>=0&&Object.defineProperty(this,b+a,{value:this[b],writable:!0,configurable:!0}),delete this[b++];return this._length+=a,this},filter:function(a){for(var b=0;b<this._length;)a(this[b++])||this.shift(-1,b,this._length-1);return this},insertListener:function(a){var b=f(this),c=b._length,d=a.priority,e=!1;for(var g=0;g<c;g++)if(b[g].priority>=d){b.splice(g,0,a),e=!0;break}return e||b.push(a),this.replace(b)},removeListener:function(a){var b,c=f(this);switch(typeof a){case"function":b=function(b){return b.callback!==a};break;case"string":b=function(b){return b.callback.name!==a};break;case"object":b=function(b){return b!==a};break;default:b=function(){return!1}}return this.replace(c.filter(b))},invoke:function(a){var b=this._length-1;if(b>=0)do if(this[b].trigger(a)===!1)return!1;while(b--);return!0}},a})