// Observer - v0.5.0 - 2012-10-06
// https://github.com/jkroso/Observer
// Copyright (c) 2012 Jakeb Rosoman; Licensed MIT
define("Subscription",[],function(){function e(e,t,n){if(typeof t!="function"||typeof n!="number")throw"Incorrect argument format";this.context=e,this.callback=t,this.priority=n}return e.prototype={trigger:function(e){return this.callback.call(this.context,e)}},e}),define("Observer",["./Subscription"],function(e){function t(e,t){var n=e.length,r,i;while(n--){i=e[n],r=i.length;if(r>0)do if(i[--r].trigger(t)===!1)return!1;while(r)}return!0}function n(e,t){var n=e._listeners.slice(),r=t.priority,i=!1;for(var s=0,o=n.length;s<o;s++)if(n[s].priority>=r){n.splice(s,0,t),i=!0;break}i||n.push(t),e._listeners=n}function r(e,t){var n;switch(typeof t){case"function":n=function(e){return e.callback!==t};break;case"string":n=function(e){return e.callback.name!==t};break;case"object":n=function(e){return e!==t};break;default:n=function(){return!1}}e._listeners=e._listeners.filter(n)}function i(e,t){var n=0,r=t.length,s,o,u=[e._listeners];while(n<r)s=t[n++],o=s[0],o in e&&(u=u.concat(i(e[o],s.slice(1))));return u}function s(e,t){var n=[e._listeners],r=t.length,i=0;while(i<r){e=e[t[i++]];if(!e)break;n.push(e._listeners)}return n}function o(e){Object.defineProperties(this,{_listeners:{value:Object.prototype.toString.call(e)==="[object Array]"?e:[],writable:!0}})}return o.prototype.get=function(e,t){if(!e)return this;e=e.split(".");var n=this,r,i=e.length,s=0;if(i)do{r=e[s++];if(n[r]instanceof o)n=n[r];else{if(n[r])throw"namespace clash: "+r;if(!t)break;n=n[r]=new o}}while(s<i);return n},o.prototype.publish=function(e,n){return typeof e=="string"?e=s(this,e.split(".")):(n=e,e=[this._listeners]),t(e,n)},o.prototype.on=function(t,r,i,s){switch(arguments.length){case 3:typeof i=="number"?(s=i,i=r,r=window):s=0;break;case 2:i=r,s=0,typeof t=="string"?r=window:(r=t,t="");break;case 1:i=t,t="",r=window,s=0;break;case 0:throw"Insufficient arguments"}var o=new e(r,i,s);return t.split(/\s+/).forEach(function(e){n(this.get(e,!0),o)},this),o},o.prototype.once=function(t,i,s,o){switch(arguments.length){case 3:typeof s=="number"?(o=s,s=i,i=window):o=0;break;case 2:s=i,i=window,o=0;break;case 1:s=t,t="",i=window,o=0;break;case 0:throw"Insufficient arguments"}var u=new e(i,s,o);return u._topics=[],u.trigger=function(e){return this._topics.forEach(function(e){r(e,this)},this),this.callback.call(this.context,e)},t.split(/\s+/).forEach(function(e){var t=this.get(e,!0);u._topics.push(t),n(t,u)},this),u},o.prototype.off=function(e,t){if(typeof e!="string"){if(!t)return r(this,e);throw"Bad topic argument"}arguments.length?e.split(/\s+/).forEach(function(e){e=this.get(e,!1),e&&r(e,t)},this):(Object.keys(this).forEach(function(e){this[e]instanceof o&&delete this[e]},this),this._listeners=[])},o.methods=function(e){return Object.keys(o.prototype).forEach(function(t){e.hasOwnProperty(t)||Object.defineProperty(e,t,{value:o.prototype[t],writable:!0,configurable:!0})}),e},o.mixin=function(e){return o.call(e),o.methods(e),e},o.invokeList=t,o.insertListener=n,o.removeListener=r,o.collect=s,o.branchingCollect=i,new o});