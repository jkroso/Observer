/*! Observer - v0.1.0 - 2012-07-16
* https://github.com/jkroso/Observer
* Copyright (c) 2012 Jakeb Rosoman; Licensed MIT */
define(function(){function a(b){return b&&a.methods(typeof b=="object"?b:this),Object.defineProperties(this,{_base:{value:new d(this,"_base"),writable:!0,configurable:!0},_map:{value:new Map,writable:!0,configurable:!0}})}function b(a,b,c){var d=0,e=a.length,f;if(a[0]!=="")while(d<e){f=a[d++];if(b.hasOwnProperty(f))b=b[f];else if(c)b=b.createSubTopic(a.slice(0,d).join("."),f,b);else break}return b}function c(a,b,c){if(typeof b!="function"||typeof c!="number")throw"Incorrect argument format";this.context=a,this.callback=b,this.priority=c}function d(a,b){Object.defineProperties(this,{_listeners:{value:new Array,writable:!0},_parent:{value:a},_name:{value:b}})}return"use strict",a.methods=function(b){return Object.keys(a.prototype).forEach(function(c){Object.defineProperty(b,c,{value:a.prototype[c],writable:!0,configurable:!0})}),b},a.prototype={publish:function(a,c){var d=this._map.get(a),e,f;d||(c||(c=a,a=""),d=b(a.split("."),this._base));do{e=d._listeners,f=e.length-1;if(f>=0)do if((a=e[f]).callback.call(a.context,c)===!1)return!1;while(f--)}while((d=d._parent)!==this);return!0},run:function(a,b){var c;if(a=this._map.get(a)){a=a._listeners,c=a.length-1;if(c>=0)do if(a[c].trigger(b)===!1)return!1;while(c--);return!0}},on:function(a,d,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=d,d=window):f=0;break;case 2:e=d,d=window,f=0;break;case 1:e=a,a="",d=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new c(d,e,f);return a.split(" ").forEach(function(a){b(a.split("."),this,!0).insertListener(g)},this._base),g},once:function(a,d,e,f){switch(arguments.length){case 3:typeof e=="number"?(f=e,e=d,d=window):f=0;break;case 2:e=d,d=window,f=0;break;case 1:e=a,a="",d=window,f=0;break;case 0:throw"Insufficient arguments"}var g=new c(d,e,f);return a.split(" ").forEach(function(a){var d=b(a.split("."),this,!0),e=new c(window,function(){d._listeners=d._listeners.filter(function(a){return a!==e&&a!==g})},g.priority);d.insertListener(g),d.insertListener(e)},this._base),g},off:function(a,b){if(typeof a!="string")if(!b)this._base.removeListener(a);else throw"no topic specified";a.split(" ").forEach(function(a){this._map.get(a)&&this._map.get(a).removeListener(b)},this)}},Object.defineProperty(a.prototype,"constructor",{value:a}),c.prototype={trigger:function(a){return this.callback.call(this.context,a)}},d.prototype={createSubTopic:function(a,b,c){var e=this,f=new d(this,b);while(e._parent)e=e._parent;return e._map.set(a,f),this[b]=f},insertListener:function(a){var b=this._listeners.slice(),c=b.length,d=a.priority,e=0,f=!1;for(;e<c;e++)if(b[e].priority>=d){b.splice(e,0,a),f=!0;break}f||b.push(a),this._listeners=b},removeListener:function(a){var b;switch(typeof a){case"function":b=function(b){return b.callback!==a};break;case"string":b=function(b){return b.callback.name!==a};break;case"object":b=function(b){return b!==a};break;default:b=function(){return!1}}this._listeners=this._listeners.filter(b)},invokeListeners:function(a){var b=this._listeners,c=b.length-1;if(c!==-1)do if(b[c].trigger(a)===!1)return!1;while(c--);return!0}},a})